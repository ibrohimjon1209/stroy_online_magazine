import{r as i,b as P,j as e,L as g,C as v,H as L,g as z,p as F,d as C,c as $}from"./index-1iWJ4YoJ.js";const Y=({searchText:u})=>{const[m,b]=i.useState([]),[h,p]=i.useState([]),[E,D]=i.useState(""),[I,q]=i.useState(!1),[k,d]=i.useState(!0),t=window.localStorage.getItem("lang"),[n,y]=i.useState(null),f=P().pathname.split("/")[2],j={border:"4px solid #f3f3f3",borderTop:"4px solid #DCC38B",borderRadius:"50%",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto"},[c,N]=i.useState(()=>{try{const s=localStorage.getItem("likedProducts");return s&&s!=="undefined"?JSON.parse(s):[]}catch(s){return console.error("Error parsing likedProducts from localStorage:",s),[]}}),w=localStorage.getItem("sl_option_nav")==="Stroy Baza №1"?0:localStorage.getItem("sl_option_nav")==="Giaz Mebel"?1:2;i.useEffect(()=>{(async()=>{try{d(!0);const[l,o]=await Promise.all([z(f),F(w)]);y(l);const r=o.filter(a=>a.category==f);console.log("categoryProducts",r),b(r.filter(a=>a.is_available===!0)),p(r.filter(a=>a.is_available===!0))}catch(l){console.error("Error fetching data:",l)}finally{d(!1)}})()},[f,w]),i.useEffect(()=>{if(u.trim()==="")p(m);else{const s=m.filter(l=>{var o;return(o=l[`name_${t}`])==null?void 0:o.toLowerCase().includes(u.toLowerCase())});d(!0),setTimeout(()=>{p(s),d(!1)},1e3)}},[u,m,t]);const _=t==="uz"?"so'm":t==="en"?"uzs":t==="ru"?"сум":"so'm",S=async s=>{const l=localStorage.getItem("userId"),o=c.some(a=>a.product===s);let r;if(!l){o?r=c.filter(a=>a.product!==s):r=[...c,{product:s}],localStorage.setItem("likedProducts",JSON.stringify(r)),N(r);return}if(o){r=c.filter(x=>x.product!==s);const a=c.find(x=>x.product===s&&x.user.toString()===l);if(a)try{await C(a.id)}catch(x){console.error("DELETE xatosi:",x)}}else{r=[...c,{user:Number.parseInt(l),product:s}];try{const a=await $(s,Number.parseInt(l))}catch(a){console.error("POST xatosi:",a);return}}localStorage.setItem("likedProducts",JSON.stringify(r)),N(r)};return e.jsx("div",{className:"w-full mb-[0px] sm:mb-[100px] flex flex-col items-center",children:e.jsxs("div",{className:"mt-[0px] sm:mt-[50px] flex flex-col w-full sm:w-[1440px] m-auto h-auto sm:px-[77px] mb-[100px] sm:mb-[0]",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(g,{className:"w-full flex items-center gap-[10px]",to:"/",children:[e.jsx(v,{className:"scale-110"}),e.jsxs("h1",{className:"flex font-inter font-[500] text-[32px] leading-[45px] text-black",children:[(n==null?void 0:n[`name_${t}`])||(t=="uz"?"Yuklanmoqda...":t=="en"?"Loading...":t=="ru"?"Загрузка...":"Yuklanmoqda..."),e.jsx("div",{className:"w-[5px]"}),e.jsxs("span",{className:"product_count_working",children:["(",m.length,")"]}),"  "]})]})}),e.jsx("div",{className:"sticky top-0 z-50 block sm:hidden",children:e.jsx("div",{className:"w-full h-[65px] bg-[#DCC38B]",children:e.jsxs(g,{className:"w-full h-full flex items-center gap-[10px] pl-[13px]",to:"/search",children:[e.jsx(v,{className:"scale-110"}),e.jsxs("h1",{className:"font-inter font-[500] text-[15px] leading-[22px] text-black",children:[(n==null?void 0:n[`name_${t}`])||(t=="uz"?"Yuklanmoqda...":t=="en"?"Loading...":t=="ru"?"Загрузка...":"Yuklanmoqda..."),e.jsxs("span",{className:"product_count",children:["(",m.length,")"]}),"  "]})]})})}),k?e.jsx("div",{className:"flex justify-center mx-auto items-center scale-[70%] sm:scale-[100%] w-[200%] h-[130px] sm:w-[500%] sm:h-[400px]",children:e.jsx("div",{style:j})}):h.length>0?e.jsx("div",{className:"mt-[20px] px-[15px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-[10px] sm:gap-x-[20px] gap-y-[15px] sm:gap-y-[30px]",children:h.map((s,l)=>{var o,r;return e.jsx("div",{className:"cursor-pointer",children:e.jsxs(g,{to:`/product/${s.id}`,children:[e.jsx("div",{className:"rounded-[10px] w-[160px] h-[160px] sm:w-[245px] sm:h-[245px] bg-[#F2F2F1] overflow-hidden group",children:e.jsx("img",{src:`https://backkk.stroybazan1.uz/${s.image}`,className:"object-cover w-full h-full transition-transform group-hover:scale-105",alt:s[`name_${t}`]})}),e.jsxs("div",{className:"flex flex-row items-end w-[165px] sm:w-[245px] justify-between mt-1.5 px-3",children:[e.jsxs("div",{className:"flex flex-col sm:gap-1",children:[e.jsx("h1",{className:"text-black max-w-[120px] sm:max-w-[180px] truncate font-semibold text-[14px] sm:text-[16px]",children:s[`name_${t}`]}),e.jsx("p",{className:"text-black text-[12px] sm:text-[14px]",children:(r=(o=s.variants)==null?void 0:o[0])!=null&&r.price?`${t==="uz"?"Narxi":t==="en"?"Price":t==="ru"?"Цена":"Narxi"}: ${Number.parseFloat(s.variants[0].price).toFixed(2)} ${_}`:t==="uz"?"Narxi mavjud emas":t==="en"?"Price not available":t==="ru"?"Цена не доступна":"Narxi mavjud emas"})]}),e.jsx(L,{className:"w-[19px] h-[19px] sm:w-[28px] sm:h-[28px] text-[#FF0000] cursor-pointer mb-0.5",fill:c.some(a=>a.product===s.id)?"#FF0000":"none",onClick:a=>{a.preventDefault(),S(s.id)}})]})]})},l)})}):e.jsx("div",{className:"flex justify-center mx-auto items-center scale-[70%] sm:scale-[100%] w-[200%] h-[130px] sm:w-[500%] sm:h-[400px]",children:e.jsx("div",{style:j})})]})})};export{Y as default};
