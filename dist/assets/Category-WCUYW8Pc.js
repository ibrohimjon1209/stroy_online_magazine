import{r as i,b as _,j as t,L as g,C as v,H as P,g as L,p as z,d as F,c as C}from"./index-CE3ONUjE.js";const J=({searchText:d})=>{const[u,b]=i.useState([]),[h,p]=i.useState([]),[$,E]=i.useState(""),[D,I]=i.useState(!1),[w,m]=i.useState(!0),s=window.localStorage.getItem("lang"),[n,k]=i.useState(null),f=_().pathname.split("/")[2],[c,N]=i.useState(()=>{try{const e=localStorage.getItem("likedProducts");return e&&e!=="undefined"?JSON.parse(e):[]}catch(e){return console.error("Error parsing likedProducts from localStorage:",e),[]}}),j=localStorage.getItem("sl_option_nav")==="Stroy Baza №1"?0:localStorage.getItem("sl_option_nav")==="Giaz Mebel"?1:2;i.useEffect(()=>{(async()=>{try{m(!0);const[l,o]=await Promise.all([L(f),z(j)]);k(l);const r=o.filter(a=>a.category==f);b(r),p(r)}catch(l){console.error("Error fetching data:",l)}finally{m(!1)}})()},[f,j]),i.useEffect(()=>{if(d.trim()==="")p(u);else{const e=u.filter(l=>{var o;return(o=l[`name_${s}`])==null?void 0:o.toLowerCase().includes(d.toLowerCase())});m(!0),setTimeout(()=>{p(e),m(!1)},1e3)}},[d,u,s]);const y=s==="uz"?"so'm":s==="en"?"uzs":s==="ru"?"сум":"so'm",S=async e=>{const l=localStorage.getItem("userId"),o=c.some(a=>a.product===e);let r;if(!l){o?r=c.filter(a=>a.product!==e):r=[...c,{product:e}],localStorage.setItem("likedProducts",JSON.stringify(r)),N(r);return}if(o){r=c.filter(x=>x.product!==e);const a=c.find(x=>x.product===e&&x.user.toString()===l);if(a)try{await F(a.id)}catch(x){console.error("DELETE xatosi:",x)}}else{r=[...c,{user:Number.parseInt(l),product:e}];try{const a=await C(e,l);if(!a||!a.data||!a.data.product){console.error("POST xatosi: Yangi like qo'shishda xatolik");return}}catch(a){console.error("POST xatosi:",a);return}}localStorage.setItem("likedProducts",JSON.stringify(r)),N(r)};return t.jsx("div",{className:"w-full mb-[0px] sm:mb-[100px] flex flex-col items-center",children:t.jsxs("div",{className:"mt-[0px] sm:mt-[50px] flex flex-col w-full sm:w-[1440px] m-auto h-auto sm:px-[77px] mb-[100px] sm:mb-[0]",children:[t.jsx("div",{className:"hidden sm:block",children:t.jsxs(g,{className:"w-full flex items-center gap-[10px]",to:"/",children:[t.jsx(v,{className:"scale-110"}),t.jsx("h1",{className:"font-inter font-[500] text-[32px] leading-[45px] text-black",children:(n==null?void 0:n[`name_${s}`])||"Category"})]})}),t.jsx("div",{className:"sticky top-0 z-50 block sm:hidden",children:t.jsx("div",{className:"w-full h-[65px] bg-[#DCC38B]",children:t.jsxs(g,{className:"w-full h-full flex items-center gap-[10px] pl-[13px]",to:"/search",children:[t.jsx(v,{className:"scale-110"}),t.jsx("h1",{className:"font-inter font-[500] text-[15px] leading-[22px] text-black",children:(n==null?void 0:n[`name_${s}`])||"Category"})]})})}),w?t.jsx("div",{className:"flex justify-center items-center w-full h-[200px]",children:t.jsx("div",{className:"loader"})}):h.length>0?t.jsx("div",{className:"mt-[20px] px-[15px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-[10px] sm:gap-x-[20px] gap-y-[15px] sm:gap-y-[30px]",children:h.map((e,l)=>{var o,r;return t.jsx("div",{className:"cursor-pointer",children:t.jsxs(g,{to:`/product/${e.id}`,children:[t.jsx("div",{className:"rounded-[10px] w-[160px] h-[160px] sm:w-[245px] sm:h-[245px] bg-[#F2F2F1] overflow-hidden group",children:t.jsx("img",{src:`https://backkk.stroybazan1.uz/${e.image}`,className:"object-cover w-full h-full transition-transform group-hover:scale-105",alt:e[`name_${s}`]})}),t.jsxs("div",{className:"flex flex-row items-end w-[165px] sm:w-[245px] justify-between mt-1.5 px-3",children:[t.jsxs("div",{className:"flex flex-col sm:gap-1",children:[t.jsx("h1",{className:"text-black truncate font-semibold text-[14px] sm:text-[16px]",children:e[`name_${s}`]}),t.jsx("p",{className:"text-black text-[12px] sm:text-[14px]",children:(r=(o=e.variants)==null?void 0:o[0])!=null&&r.price?`${s==="uz"?"Narxi":s==="en"?"Price":s==="ru"?"Цена":"Narxi"}: ${Number.parseFloat(e.variants[0].price).toFixed(2)} ${y}`:s==="uz"?"Narxi mavjud emas":s==="en"?"Price not available":s==="ru"?"Цена не доступна":"Narxi mavjud emas"})]}),t.jsx(P,{className:"w-[19px] h-[19px] sm:w-[28px] sm:h-[28px] text-[#FF0000] cursor-pointer mb-0.5",fill:c.some(a=>a.product===e.id)?"#FF0000":"none",onClick:a=>{a.preventDefault(),S(e.id)}})]})]})},l)})}):t.jsx("p",{className:"mt-4 text-center text-gray-500",children:s==="uz"?"Ma'lumot topilmadi.":s==="en"?"No data found.":s==="ru"?"Данные не найдены.":"Ma'lumot topilmadi."})]})})};export{J as default};
