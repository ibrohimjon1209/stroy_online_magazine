import{r as i,b as _,j as e,L as g,C as v,H as P,g as L,p as z,d as F,c as C}from"./index-BM7zmA_f.js";const J=({searchText:d})=>{const[p,w]=i.useState([]),[h,u]=i.useState([]),[$,E]=i.useState(""),[D,I]=i.useState(!1),[b,m]=i.useState(!0),s=window.localStorage.getItem("lang")||"uz",[n,y]=i.useState(null),f=_().pathname.split("/")[2],[c,N]=i.useState(()=>JSON.parse(localStorage.getItem("likedProducts"))||[]),j=localStorage.getItem("sl_option_nav")==="Story Baza №1"?0:localStorage.getItem("sl_option_nav")==="Mebel"?1:2;i.useEffect(()=>{(async()=>{try{m(!0);const[r,o]=await Promise.all([L(f),z(j)]);y(r);const l=o.filter(a=>a.category==f);w(l),u(l)}catch(r){console.error("Error fetching data:",r)}finally{m(!1)}})()},[f,j]),i.useEffect(()=>{if(d.trim()==="")u(p);else{const t=p.filter(r=>{var o;return(o=r[`name_${s}`])==null?void 0:o.toLowerCase().includes(d.toLowerCase())});m(!0),setTimeout(()=>{u(t),m(!1)},1e3)}},[d,p,s]);const S=s==="uz"?"so'm":s==="en"?"uzs":s==="ru"?"сум":"so'm",k=async t=>{const r=localStorage.getItem("userId"),o=c.some(a=>a.product===t);let l;if(!r){o?l=c.filter(a=>a.product!==t):l=[...c,{product:t}],localStorage.setItem("likedProducts",JSON.stringify(l)),N(l);return}if(o){l=c.filter(x=>x.product!==t);const a=c.find(x=>x.product===t&&x.user.toString()===r);if(a)try{await F(a.id)}catch(x){console.error("DELETE xatosi:",x)}}else{l=[...c,{user:parseInt(r),product:t}];try{const a=await C(t,r);if(!a||!a.data||!a.data.product){console.error("POST xatosi: Yangi like qo'shishda xatolik");return}}catch(a){console.error("POST xatosi:",a);return}}localStorage.setItem("likedProducts",JSON.stringify(l)),N(l)};return e.jsx("div",{className:"w-full mb-[0px] sm:mb-[100px] flex flex-col items-center",children:e.jsxs("div",{className:"mt-[0px] sm:mt-[50px] flex flex-col w-full sm:w-[1440px] m-auto h-auto sm:px-[77px] mb-[100px] sm:mb-[0]",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(g,{className:"w-full flex items-center gap-[10px]",to:"/",children:[e.jsx(v,{className:"scale-110"}),e.jsx("h1",{className:"font-inter font-[500] text-[32px] leading-[45px] text-black",children:(n==null?void 0:n[`name_${s}`])||"Category"})]})}),e.jsx("div",{className:"sticky top-0 z-50 block sm:hidden",children:e.jsx("div",{className:"w-full h-[65px] bg-[#DCC38B]",children:e.jsxs(g,{className:"w-full h-full flex items-center gap-[10px] pl-[13px]",to:"/",children:[e.jsx(v,{className:"scale-110"}),e.jsx("h1",{className:"font-inter font-[500] text-[15px] leading-[22px] text-black",children:(n==null?void 0:n[`name_${s}`])||"Category"})]})})}),b?e.jsx("div",{className:"flex justify-center items-center w-full h-[200px]",children:e.jsx("div",{className:"loader"})}):h.length>0?e.jsx("div",{className:"mt-[20px] px-[15px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-[10px] sm:gap-x-[20px] gap-y-[15px] sm:gap-y-[30px]",children:h.map((t,r)=>{var o,l;return e.jsx("div",{className:"cursor-pointer",children:e.jsxs(g,{to:`/product/${t.id}`,children:[e.jsx("div",{className:"rounded-[10px] w-[160px] h-[160px] sm:w-[245px] sm:h-[245px] bg-[#F2F2F1] overflow-hidden group",children:e.jsx("img",{src:`https://back.stroybazan1.uz/${t.image}`,className:"object-cover w-full h-full transition-transform group-hover:scale-105",alt:t[`name_${s}`]})}),e.jsxs("div",{className:"flex flex-row items-end w-[165px] sm:w-[245px] justify-between mt-1.5 px-3",children:[e.jsxs("div",{className:"flex flex-col sm:gap-1",children:[e.jsx("h1",{className:"text-black truncate font-semibold text-[14px] sm:text-[16px]",children:t[`name_${s}`]}),e.jsx("p",{className:"text-black text-[12px] sm:text-[14px]",children:(l=(o=t.variants)==null?void 0:o[0])!=null&&l.price?`${s==="uz"?"Narxi":s==="en"?"Price":s==="ru"?"Цена":"Narxi"}: ${parseFloat(t.variants[0].price).toFixed(2)} ${S}`:s==="uz"?"Narxi mavjud emas":s==="en"?"Price not available":s==="ru"?"Цена не доступна":"Narxi mavjud emas"})]}),e.jsx(P,{className:"w-[19px] h-[19px] sm:w-[28px] sm:h-[28px] text-[#FF0000] cursor-pointer mb-0.5",fill:c.some(a=>a.product===t.id)?"#FF0000":"none",onClick:a=>{a.preventDefault(),k(t.id)}})]})]})},r)})}):e.jsx("p",{className:"mt-4 text-center text-gray-500",children:s==="uz"?"Ma'lumot topilmadi.":s==="en"?"No data found.":s==="ru"?"Данные не найдены.":"Ma'lumot topilmadi."})]})})};export{J as default};
